<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>{{ board.title }}</title>
</head>

<body>
    <a href="{% url 'board' %}">목록으로</a>
    {% if user.username == board.author %}
    <a href="{% url 'board_update' board.id %}">수정</a>
    <span onclick="boardDelete()">삭제</span>
    {% endif %}
    <div class="board">
        <ul>
            <li>
                <h1>제목 : {{ board.title }}</h1>
            </li>
            <li>
                <h3>작성자 : {{ board.author }}</h3>
            </li>
            <li>
                <h3>날짜 : {{ board.date|date:"Y-m-d" }}</h3>
            </li>
            <li>
                <div>내용 : {{ board.contents }}</div>
            </li>
            <li>
                <div>태그 : {{ board.tag }}</div>
            </li>
        </ul>
    </div>
    <hr>
    <div class="comments">
        {% for comment in board.comment_set.all %}
        <ul>
            <li>
                <h3>작성자 : {{ comment.author }}</h3>
            </li>
            <li>
                <h3>날짜 : {{ comment.date|date:"Y-m-d" }}</h3>
            </li>
            <li>
                <div>내용 : <span id="comment{{ comment.id }}">{{ comment.contents }}</span></div>
            </li>
            {% if user.username == comment.author %}
            <li>
                <span onclick="commentUpdate('comment{{ comment.id }}')">수정</span>
                <a href="">삭제</a>
            </li>
            {% endif %}
        </ul>
        {% endfor %}
    </div>
    <div>
        <form method="POST">
            {% csrf_token %}
            <textarea name="contents" id="" cols="30" rows="10" maxlength="300"></textarea>
            <br>
            <input type="submit" value="작성">
        </form>
    </div>
    <script>
        function boardDelete(){
            let actionPath = "{% url 'board_delete' board.id %}"

            if(confirm('삭제하시겠습니까?')){
                let form = document.createElement('form')
                let body = document.getElementsByTagName('body')[0]
                form.setAttribute('method', 'POST')
                form.setAttribute('action', actionPath)
                body.appendChild(form)
                form.innerHTML = '{% csrf_token %}'
                form.submit()
            }
        }

        function commentUpdate(id){
            let commentSpan = document.getElementById(id)
            let temp = commentSpan.innerHTML
            commentSpan.replaceChild(`<textarea name="contents" id="" cols="30" rows="10" maxlength="300">${temp}</textarea>`)
        }
    </script>
</body>

</html>